# Project Pipeline with Dependency Enforcement - Google Sheets Edition

A robust, scalable migration of your Notion-based project pipeline into Google Sheets, with strict phase-gate validation, automatic status reverts, structured error logging, and Slack + Salesforce integrations via Zapier.

This solution has been significantly refactored for improved performance, maintainability, and ease of setup.

## Key Features

- **Fully Automated Setup**: A custom menu (`Mobility123 PM`) handles the entire setup process. It creates all required sheets, sets headers, applies all necessary formulas, and installs the script trigger. No more manual copying and pasting.
- **Automated Phase-Gate Enforcement**: A powerful Apps Script enforces business rules, reverts invalid status changes, adds explanatory notes to cells, and logs issues to a dedicated `Ops Inbox`.
- **Dynamic & Robust**: The script is resilient to changes in column order and gracefully ignores routine edits from Zapier to prevent unnecessary processing.
- **Configurable Admins**: A simple UI allows you to define which users can access the "override" functionality without needing to edit any code.
- **Comprehensive Views**: `QUERY`-based tabs provide read-only views for `Upcoming` and `Framing` projects, and a powerful dashboard provides high-level KPIs and analytics, all set up automatically.
- **External Integrations**: A detailed guide (`docs/04_zapier_integration_guide.md`) explains how to connect the sheet to Slack and Salesforce.

---

## 1. Setup Instructions

The setup process is now fully automated.

### Step 1: Create the Google Sheet & Install the Script
1.  Create a new Google Sheet. You can name it whatever you like (e.g., "Project Pipeline").
2.  Open the script editor by going to **Extensions → Apps Script**.
3.  Copy the contents of `src/config.gs` and `src/main.gs` from this repository and paste them into new script files in your Apps Script project. Ensure the filenames in Apps Script match (`config.gs` and `main.gs`).
4.  Save the script project (File → Save).

### Step 2: Run the Automated Setup
1.  Refresh the Google Sheet in your browser. After a moment, a new menu named **Mobility123 PM** should appear.
2.  Click **Mobility123 PM → Verify & Setup Sheet**.
3.  A confirmation prompt will appear. Click **OK** to proceed.
4.  The script will set up all sheets, headers, and formulas. You will be asked to authorize the script during this process. Please grant it the required permissions.
5.  A report will show you the actions taken.

### Step 3: Final Configuration
1.  The setup script will have created a `Lists` tab. Go to this tab and paste in the canonical lists for your dropdown menus (Project Status, Permits, etc.), with each list in its own column and a header in the first row.
2.  Use the **Data → Named ranges** and **Data → Data validation** tools to hook up your dropdowns. For example, name the range of statuses `List_ProjectStatus` and use it to create a dropdown in the `Project Status` column.
3.  Go to **Mobility123 PM → Configure Admins** to set the list of users who can use the override feature.

---

## 2. Developer Information

### Script Configuration
The core configuration for the sheet (headers, formulas, etc.) is located in `src/config.gs`. This allows for easy updates and version control. Developers can modify this file to change the sheet's structure and behavior.

### Admin Users
The "Override: Allow Advance" checkbox can only be used by authorized administrators. To configure who is an admin:
1.  Click **Mobility123 PM → Configure Admins**.
2.  Enter a comma-separated list of user email addresses in the prompt.
3.  Click OK. The list is saved securely in Script Properties and can be updated anytime.

---

## 3. Column Schemas

The following column schemas are **automatically created** by the setup script. This section is for informational purposes.

### 3.1 Project Pipeline
The main sheet for tracking projects. It includes automatically calculated columns for task progress, validation checks, and metadata.

### 3.2 Tasks
A sheet for tracking subtasks related to projects in the pipeline.

### 3.3 Upcoming, Framing, and Dashboard
These are read-only sheets generated by `QUERY` formulas, providing different views of the project data.

### 3.4 Ops Inbox
A sheet that logs any errors or issues detected by the automation script.

---

## 4. Zapier Integrations

See `docs/04_zapier_integration_guide.md` for detailed steps on connecting the Google Sheet to Slack and Salesforce.

---

## 5. Governance

-   All data entry should be done in the `Project Pipeline` and `Tasks` sheets.
-   The `Upcoming`, `Framing`, and `Dashboard` sheets are read-only and will be overwritten by their formulas.
-   The admin override window is 24 hours. The script manages this automatically.
-   Keep dropdown option strings identical to the canonical options on the `Lists` sheet to ensure data validation works correctly.
